"undefined"===typeof darwino&&(darwino={__modules:{},version:"1.0.0",provide:function(a,b,c){this.__modules[a]||(this.__modules[a]=c.call()||!0)},install:function(a,b){var c=darwino[a]=darwino[a]||{};if(b)for(var d in b)c[d]=b[d];return c}});
darwino.provide("darwino/HtmlUtils",null,function(){darwino.install("Utils",{byId:function(a){return this.isString(a)?document.getElementById(a):a},removeChildren:function(a){if(a=this.byId(a))for(;a.firstChild;)a.removeChild(a.firstChild)},setText:function(a,c){if(a=this.byId(a)){this.removeChildren(a);var b=Array.prototype.slice.call(arguments,1),b=document.createTextNode(this.format.apply(this,b));a.appendChild(b)}}})});
darwino.provide("darwino/Logger",null,function(){darwino.install("log",{logLevels:{},NONEL:2147483647,ERROR:1E3,WARN:900,INFO:800,DEBUG:300,_print:function(a){return console.log(a)},print:function(a){return this._print(darwino.Utils.format.apply(null,Array.prototype.slice.call(arguments,0)))},logException:function(a){return this._print(a.toString())},e:function(a,b){if(this.logLevels[a]>=this.ERROR)return this.print("[ERROR "+a+"] "+darwino.Utils.format.apply(null,Array.prototype.slice.call(arguments,
1)))},w:function(a,b){if(this.logLevels[a]>=this.WARN)return this.print("[WARN "+a+"] "+darwino.Utils.format.apply(null,Array.prototype.slice.call(arguments,1)))},i:function(a,b){if(this.logLevels[a]>=this.INFO)return this.print("[INFO "+a+"] "+darwino.Utils.format.apply(null,Array.prototype.slice.call(arguments,1)))},d:function(a,b){if(this.logLevels[a]>=this.DEBUG)return this._print("[DEBUG "+a+"]"+darwino.Utils.format.apply(null,Array.prototype.slice.call(arguments,1)))},isLogEnabled:function(a,
b){return this.logLevels[a]>=b},enable:function(a,b){this.logLevels[a]=b}});darwino.print=function(){darwino.log.print.apply(darwino.log,arguments)}});
darwino.provide("darwino/Utils",null,function(){darwino.install("Utils",{isString:function(a){return a&&("string"==typeof a||a instanceof String)},isObject:function(a){return a&&("object"==typeof a||a instanceof Object)},isArray:function(a){return a&&("array"==typeof a||a instanceof Array)},isNumber:function(a){return a&&("number"==typeof a||a instanceof Number)},isBoolean:function(a){return a&&("boolean"==typeof a||a instanceof Boolean)},isDate:function(a){return a&&a instanceof Date},concatPath:function(){for(var a=
arguments[0],b=1;b<arguments.length;b++)a=this.removeTrailingSep(a)+"/"+this.removeLeadingSep(arguments[b]);return a},addTrailingSep:function(a){return this.endsWith(a,"/")?a:a+"/"},removeTrailingSep:function(a){return this.endsWith(a,"/")?this.left(a,-1):a},addLeadingSep:function(a){return this.startsWith(a,"/")?a:"/"+a},removeLeadingSep:function(a){return this.startsWith(a,"/")?a.substring(1):a},toJson:function(a,b){return b?JSON.stringify(a):JSON.stringify(a,null,4)},fromJson:function(a){return eval("("+
a+")")},jsonPath:null,isEmptyObject:function(a){if(a)for(var b in a)return!1;return!0},left:function(a,b){0>b&&(b=a.length+b);return a.substring(0,Math.min(b,a.length))},startsWith:function(a,b){return a.length>=b.length&&a.substring(0,b.length)==b},startsWithIgnoreCase:function(a,b){return a.length>=b.length&&a.substring(0,b.length).toLowerCase()==b.toLowerCase()},endsWith:function(a,b){return a.length>=b.length&&a.substring(a.length-b.length)==b},endsWithIgnoreCase:function(a,b){return a.length>=
b.length&&a.substring(a.length-b.length).toLowerCase()==b.toLowerCase()},equals:function(a,b){return a?b?a==b:!1:!b},equalsIgnoreCase:function(a,b){return a?b?a.toLowerCase()==b.toLowerCase():!1:!b},uuid:function(){return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16).toUpperCase()})},format:function(a){for(var b=1;b<arguments.length;b++)a=(a||"").replace("{"+(b-1)+"}",arguments[b]);return a},toUtf8:function(a){if(null===
a||"undefined"===typeof a)return"";a+="";var b="",c,g,e=0;c=g=0;for(var e=a.length,f=0;f<e;f++){var d=a.charCodeAt(f),h=null;if(128>d)g++;else if(127<d&&2048>d)h=String.fromCharCode(d>>6|192,d&63|128);else if(d&1)h=String.fromCharCode(d>>12|224,d>>6&63|128,d&63|128);else{if(d&1)throw new RangeError("Unmatched trail surrogate at "+f);h=a.charCodeAt(++f);if(h&1)throw new RangeError("Unmatched lead surrogate at "+(f-1));d=((d&1023)<<10)+(h&1023)+65536;h=String.fromCharCode(d>>18|240,d>>12&63|128,d>>
6&63|128,d&63|128)}null!==h&&(g>c&&(b+=a.slice(c,g)),b+=h,c=g=f+1)}g>c&&(b+=a.slice(c,e));return b},fromUtf8:function(a){var b=[],c=0,g=0,e=0,f=0,d=0,h=0;for(a+="";c<a.length;)e=a.charCodeAt(c),191>=e?(b[g++]=String.fromCharCode(e),c++):223>=e?(f=a.charCodeAt(c+1),b[g++]=String.fromCharCode((e&31)<<6|f&63),c+=2):239>=e?(f=a.charCodeAt(c+1),d=a.charCodeAt(c+2),b[g++]=String.fromCharCode((e&15)<<12|(f&63)<<6|d&63),c+=3):(f=a.charCodeAt(c+1),d=a.charCodeAt(c+2),h=a.charCodeAt(c+3),e=(e&7)<<18|(f&63)<<
12|(d&63)<<6|h&63,e-=65536,b[g++]=String.fromCharCode(55296|e>>10&1023),b[g++]=String.fromCharCode(56320|e&1023),c+=4);return b.join("")},parseXml:function(a){var b=null;try{document.evaluate?window.DOMParser&&(parser=new DOMParser,b=parser.parseFromString(a,"text/xml")):(b=new ActiveXObject("Microsoft.XMLDOM"),b.async="false",b.loadXML(a))}catch(c){b=void 0}return b},xmlString:function(a){return a?window.ActiveXObject?a.xml:(new XMLSerializer).serializeToString(a):""},dateToString:function(a){return a?
a.toISOString():null},stringToDate:function(a){var b=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(\.\d{1,3})?(Z|(?:[+-](\d{2}):(\d{2})))?$/g.exec(a);if(!b)return null;a=parseInt(b[1]);var c=parseInt(b[2]),g=parseInt(b[3]),e=parseInt(b[4]),f=parseInt(b[5]),d=parseInt(b[6]),h=b[7]?parseInt(b[7].substring(1)):0,k=0;if(8<b.length&&b[8]){var l=b[8].charAt(0);if("+"==l||"-"==l)k=parseInt(b[9]),b=parseInt(b[10]),k=36E5*k+6E4*b,"+"==l&&(k=-k)}a=Date.UTC(a,c-1,g,e,f,d,h);return new Date(a+k)},atob:null,
btoa:null,promise:null,now:function(){return(new Date).getTime()},intAsString:function(a){return a.toFixed()}})});
darwino.provide("darwino/jstore/exception",null,function(){function a(a,b,c,d,e,f,g,h,k,l,m){this._msg=(a||"").replace("{0}",b).replace("{1}",c).replace("{2}",d).replace("{3}",e).replace("{4}",f).replace("{5}",g).replace("{6}",h).replace("{7}",k).replace("{8}",l).replace("{9}",m)}var b=darwino.install("jstore");a.prototype.toString=function(){return this._msg};b.JsonException=b.JsonDBException=a});
darwino.provide("darwino/jstore/jstore",null,function(){var a=darwino.install("jstore");a.Attachment={OP_NOOP:0,OP_CREATED:1,OP_UPDATED:2,OP_DELETED:3};a.Cursor={HIERARCHY_FLAT:0,HIERARCHY_ONE:1,HIERARCHY_ALL:99999,DATA_VALUE:16,DATA_DOCUMENT:32,DATA_NONE:64,DATA_MODDATES:128,DATA_READMARK:256,DATA_WRITEACC:512,HIERARCHY_NOSQL:4096,QUERY_NOSQL:16384,RANGE_ROOT:32768,TAGS_OR:65536,NULL_PARENT:"",INDEX_STORE_SEP:":"};a.CursorEntry={};a.Database={STORE_DEFAULT:"_default",STORE_LOCAL:"_local",STORE_COMMENTS:"_comments",
STORE_DESIGN:"_design",DOCSEC_NONE:0,DOCSEC_INCLUDE:1,DOCSEC_EXCLUDE:2,DOCSEC_ALL:4};a.Document={SAVE_NOREAD:1,JSON_DOCUMENT:1,JSON_ALLATTACHMENTS:2,JSON_UPDATEDATTACHMENTS:4,JSON_ATTACHMENTCONTENT:8,JSON_ATTACHMENTURL:16,SYSTEM_PREFIX:"_",SYSTEM_READERS:"_readers",SYSTEM_WRITERS:"_writers",SYSTEM_EREADERS:"_ereaders",SYSTEM_EWRITERS:"_ewriters",SYSTEM_TAGS:"_tags",SYSTEM_PARENTID:"_parentid",SYSTEM_SYNCMASTERID:"_syncmasterid",STORE_UNID_SEP:":"};a.Index={};a.Instance={};a.Session={};a.Store={DOCUMENT_NOREADMARK:1,
DOCUMENT_CREATE:2,DELETE_NORMAL:0,DELETE_SOFT:1,DELETE_ERASE:2,DELETE_CHILDREN:256,DELETE_SYNCSLAVES:512}});
darwino.provide("darwino/jstore/urlbuilder",null,function(){function a(b){(this._baseUrl=b)&&!darwino.Utils.endsWith(this._baseUrl,"/")&&(this._baseUrl+="/")}var c=darwino.install("jstore");a.prototype.getBaseUrl=function(){return this._baseUrl||""};a.prototype.getDatabaseUrl=function(b){return this.getBaseUrl()+"databases/"+b};a.prototype.getDesignElementUrl=function(b,a){return this.getBaseUrl()+"design/"+b+"/"+a};a.prototype.getStoreUrl=function(b,a){return this.getBaseUrl()+"databases/"+b+"/stores/"+
a};a.prototype.getDocumentUrl=function(a,d,e){return this.getBaseUrl()+"databases/"+a+"/stores/"+d+"/documents/"+e};a.prototype.getAttachmentUrl=function(a,d,e,c){return(this.getBaseUrl()||"")+"databases/"+a+"/stores/"+d+"/documents/"+e+"/attachments/"+c};c._UrlBuilder=a});
darwino.provide("darwino/jstore/user",null,function(){function a(a,b,c,d){this._dn=a||"anonymous";this._cn=b||this._dn;this._groups=c;this._roles=d;this._attr={}}var c=darwino.install("jstore");a.prototype.isAnonymous=function(){return"anonymous"!=this._dn};a.prototype.getDn=function(){return this._dn};a.prototype.getCn=function(){return this._cn};a.prototype.getDistinguishedName=function(){return this._dn};a.prototype.getCommonName=function(){return this._cn};a.prototype.getGroupCount=function(){return this._groups?
this._groups.length:0};a.prototype.getGroup=function(a){return this._groups[a]};a.prototype.getGroups=function(){return this._groups};a.prototype.getRoleCount=function(){return this._roles?this._roles.length:0};a.prototype.getRole=function(a){return this._roles[a]};a.prototype.getRoles=function(){return this._roles};a.prototype.hasUserId=function(a){return this._dn==a};a.prototype.hasGroup=function(a){if(this._groups)for(var b=0;b<this._groups.length;b++)if(this._groups[b]==a)return!0;return!1};a.prototype.hasRole=
function(a){if(this._roles)for(var b=0;b<this._roles.length;b++)if(this._roles[b]==a)return!0;return!1};a.prototype.getAttribute=function(a){return this._attrs[a]};a.prototype.putAttribute=function(a,b){this._attrs[a]=b};c._User=a});
darwino.provide("darwino/jstore/remote/attachment",null,function(){function a(a,d,c,e,f,g,h){this._doc=a;this._name=d;this._dbOperation=b.Attachment.OP_CREATED;this._content=c;3<arguments.length?(this._length=e,this._mimeType=f,this._seqid=g,this._mdate=h):(this._length=c.getLength(),this._mimeType=c.getMimeType())}var b=darwino.install("jstore");a.prototype.getHttpStoreClient=function(){return this._doc.getHttpStoreClient()};a.prototype.getSession=function(){return this._doc._store._database._session};
a.prototype.getDatabase=function(){return this._doc._store._database};a.prototype.getStore=function(){return this._doc._store};a.prototype.getDocument=function(){return this._doc};a.prototype.getDbOperation=function(){return this._dbOperation};a.prototype.getSeqId=function(){return this._seqid};a.prototype.getLastModificationDate=function(){return this._mdate};a.prototype.getETag=function(){return this._name+"-"+this._mdate.getTime().toString(16)};a.prototype.getName=function(){return this._name};
a.prototype.getLength=function(){return this._length};a.prototype.getMimeType=function(){return this._mimeType};a.prototype.getBinKey=function(){return null};a.prototype.update=function(a){if(this._dbOperation==b.Attachment.OP_DELETED)throw new b.JsonException("Cannot update an attachment that is tagged as deleted");this._dbOperation==b.Attachment.OP_NOOP&&(this._dbOperation=b.Attachment.OP_UPDATED);this._content=a;null!=a?(this._length=a.length,this._mimeType=a.mimetype):(this._length=0,this._mimeType=
null)};a.prototype.deleteAttachment=function(){this._dbOperation=b.Attachment.OP_DELETED;this._content=null};a.prototype.getAttachmentUrl=function(){var a=this.getSession().getUrlBuilder();return a?a.getAttachmentUrl(this.getDatabase().getId(),this.getStore().getId(),this.getDocument().getUnid(),this.getName()):null};a.prototype.readAsBinaryString=function(){return this._content?this._content.getAsBinaryString():this.getHttpStoreClient().readAttachment(this._doc._store._database._name,this._doc._store._name,
this._doc._unid,this._name)};a.prototype.readAsBase64=function(){return this._content?this._content.getAsBase64():darwino.Utils.btoa(this.getHttpStoreClient().readAttachment(this._doc._store._database._name,this._doc._store._name,this._doc._unid,this._name))};a.prototype.readAsString=function(){var a=this.readAsBinaryString();return darwino.Utils.fromUtf8(a)};b.createBinaryContent=function(a,b,c){return darwino.Utils.createBinaryContent(a,b,c)};b.createBinaryContentBase64=function(a,b,c){return darwino.Utils.createBinaryContent(a,
b?darwino.Utils.atob(b):null,c)};b._RemoteAttachment=a});
darwino.provide("darwino/jstore/remote/cursor",null,function(){function b(a,b){this._store=a;this._index=b}var f=darwino.install("jstore");b.prototype.getHttpStoreClient=function(){return this._store.getHttpStoreClient()};b.prototype.getSession=function(){return this._store._database._session};b.prototype.getDatabase=function(){return this._store._database};b.prototype.getStore=function(){return this._store};b.prototype.getIndex=function(){return this._index};b.prototype.key=function(a){this._key=
a;return this};b.prototype.partialKey=function(a){this._partialKey=a;return this};b.prototype.tags=function(a){this._tags=Array.slice(arguments,0);return this};b.prototype.id=function(a){this._id=a;return this};b.prototype.unid=function(a){this._unid=a;return this};b.prototype.parentUnid=function(a){this._parentId=a;return this};b.prototype.parent=function(a){a?a._store.getId()==this._store.getId()?this.parentUnid(a.getUnid()):this.parentUnid(a.getUnid()+f.Document.STORE_UNID_SEP+a._store.getId()):
this.setParentUnid(null);return this};b.prototype.startKey=function(a,b){this._startKey=a;this._excludeStart=b;return this};b.prototype.endKey=function(a,b){this._endKey=a;this._excludeEnd=b;return this};b.prototype.options=function(a){this._options=a;return this};b.prototype.hierarchical=function(a){this._hierarchical=a;0<a&&!this._parentId&&(this._parentId=f.Cursor.NULL_PARENT);return this};b.prototype.hierarchySources=function(a){this._hierarchySources=Array.slice(arguments,0);return this};b.prototype.range=
function(a,b){this._skip=a;this._limit=b;return this};b.prototype.orderBy=function(a){this._orderBy=Array.slice(arguments,0);return this};b.prototype.categories=function(a,b){this._categoryCount=a||0;this._categoryStart=b||0;return this};b.prototype.ascending=function(){delete this._descending;return this};b.prototype.descending=function(){this._descending=!0;return this};b.prototype.orderByFtRank=function(){this.orderBy("_ftRank");return this};b.prototype.ftSearch=function(a){this._ftSearch=a;return this};
b.prototype.query=function(a){darwino.Utils.isString(a)||(a=darwino.Utils.toJson(a));this._query=a;return this};b.prototype.extract=function(a){darwino.Utils.isString(a)||(a=darwino.Utils.toJson(a));this._extract=a;return this};b.prototype.aggregate=function(a){darwino.Utils.isString(a)||(a=darwino.Utils.fromJson(a));this._agg=a;return this};b.prototype.subQueries=function(){this._subQueries=[].slice.call(arguments);return this};b.prototype.findSubQuery=function(a){if(this._subQueries)for(var b=0;b<
this._subQueries.length;b++)if(this._subQueries[b].name==a)return this._subQueries[b];return null};b.prototype.count=function(){return this.getHttpStoreClient().count(this,!1).count};b.prototype.countWithLimit=function(){return this.getHttpStoreClient().count(this,!0).count};b.prototype.findOne=function(){var a=this.findOneJson();return a?new f._RemoteCursorEntry(this,a):null};b.prototype.find=function(a){var b=this.findJson();if(b&&a){for(var e=0,c=0;c<b.length;c++){var d=new f._RemoteCursorEntry(this,
b[c]);a.handle?a.handle(d):a(d);0!=(this._options&f.Cursor.RANGE_ROOT)&&0!=d.getHierarchicalLevel()||e++}return e}return 0};b.prototype.findIds=function(){return this.getHttpStoreClient().findIds(this)};b.prototype.findOneJson=function(){return this.getHttpStoreClient().findOneJson(this)};b.prototype.findJson=function(){return this.getHttpStoreClient().findJson(this)};b.prototype.findJsonTree=function(){return this.getHttpStoreClient().findJsonTree(this)};b.prototype.deleteAllDocuments=function(a){this.getHttpStoreClient().deleteCursor(this,
a)};b.prototype.markAllRead=function(a,b){this.getHttpStoreClient().markAllRead(this,a,b)};b.prototype.toJson=function(){var a={};void 0!=this._ftSearch&&(a.ftSearch=this._ftSearch);0<this._id&&(a.id=this._id);void 0!=this._unid&&(a.unid=this._unid);0<this._hierarchical&&(a.hierarchical=this._hierarchical);this._hierarchySources&&(a.hierarchySources=this._hierarchySources);void 0!=this._parentId&&(a.parentId=this._parentId);void 0!=this._key&&(a.key=this._key);void 0!=this._partialKey&&(a.partialKey=
this._partialKey);void 0!=this._startKey&&(a.startKey=this._startKey);this._excludeStart&&(a.excludeStart=!0);void 0!=this._endKey&&(a.endKey=this._endKey);this._excludeEnd&&(a.excludeEnd=!0);this._orderBy&&(a.orderBy=this._orderBy);this._categoryCount&&(a.categoryCount=this._categoryCount);this._categoryStart&&(a.categoryStart=this._categoryStart);this._descending&&(a.descending=!0);this._tags&&(a.tags=this._tags);0<this._skip&&(a.skip=this._skip);0<this._limit&&(a.limit=this._limit);this._options&&
(a.options=this._options);this._query&&(a.query=this._query);this._extract&&(a.extract=this._extract);this._agg&&(a.aggregate=this._agg);if(this._subQueries)for(var b=a.subQueries=[],e=0;e<this._subQueries.length;e++){var c=this._subQueries[e],d=c.cursor,c={cursor:d.toJson(),name:c.name,type:c.type,params:c.params};c.cursor.store=d.getStore().getId();d.getIndex()&&(c.cursor.index=d.getIndex().getId());b.push(c)}return a};b.prototype.fromJson=function(a){this._ftSearch=a.ftSearch;this._id=a.id;this._unid=
a.unid;this._hierarchical=a.hierarchical;this._hierarchySources=a.hierarchySources;this._parentId=a.parentId;this._key=a.key;this._partialKey=a.partialKey;this._startKey=a.startKey;this._excludeStart=a.excludeStart;this._endKey=a.endKey;this._excludeEnd=a.excludeEnd;this._orderBy=a.orderBy;this._categoryCount=a.categoryCount;this._categoryStart=a.categoryStart;this._descending=a.descending;this._tags=a.tags;this._skip=a.skip;this._limit=a.limit;this._options=a.options;this._query=a.query;this._extract=
a.extract;this._agg=a.aggregate;if(a.subQueries)for(var f=this._subQueries=[],e=0;e<a.subQueries.length;e++){var c=a.subQueries[e],d=this.getDatabase().getStore(c.cursor.store),d=c.cursor.index?new b(d,d.getIndex(c.cursor.index)):new b(d,null);d.fromJson(c.cursor);f.push({cursor:d,name:c.name,type:c.type,params:c.params})}};f._RemoteCursor=b});
darwino.provide("darwino/jstore/remote/cursorentry",null,function(){function a(b,a){this._cursor=b;this._entry=a}var c=darwino.install("jstore");a.prototype.getSession=function(){return this._cursor.getSession()};a.prototype.getDatabase=function(){return this._cursor.getDatabase()};a.prototype.getStore=function(){return this._cursor.getStore()};a.prototype.getCursor=function(){return this._cursor};a.prototype.getPosition=function(){return this._entry.position};a.prototype.getKey=function(){return this._entry.key};
a.prototype.getValue=function(){return this._entry.value};a.prototype.getFtRank=function(){return this._entry.ftRank};a.prototype.getStoreId=function(){return this._entry.storeId};a.prototype.getDocId=function(){return this._entry.id};a.prototype.getUnid=function(){return this._entry.unid||""};a.prototype.getCreationDate=function(){return this._entry.cdate?new Date(this._entry.cdate):null};a.prototype.getCreationUser=function(){return this._entry.cuser||""};a.prototype.getLastModificationDate=function(){return this._entry.mdate?
new Date(this._entry.mdate):null};a.prototype.getLastModificationUser=function(){return this._entry.muser||""};a.prototype.getParentUnid=function(){return this._entry.parentUnid||""};a.prototype.getHierarchicalLevel=function(){return this._entry.hierarchicalLevel||0};a.prototype.isCategory=function(){return this._entry.category};a.prototype.getCategoryCount=function(){return this._entry.categoryCount||0};a.prototype.isRead=function(){return this._entry.read};a.prototype.isReadOnly=function(){return this._entry.readOnly};
a.prototype.indentLevel=function(){return this._entry.indentLevel||0};a.prototype.loadDocument=function(b){b=this._cursor.getDatabase().loadDocumentById(this.getDocId(),b);this._cursor.getStore().clearSocialDataCache(b.getUnid());return b};a.prototype.createJsonEntry=function(){return this._entry};a.prototype.get=function(b){var a=this.getValue();if(darwino.Utils.isObject(a))return a[b];throw new c.JsonException("The JSON data is not an object");};a.prototype.getString=function(b){b=this.get(b);return darwino.Utils.isString(b)?
b:null};a.prototype.getInt=function(b){b=this.get(b);return darwino.Utils.isNumber(b)?b:null};a.prototype.getLong=function(b){b=this.get(b);return darwino.Utils.isNumber(b)?b:null};a.prototype.getDouble=function(b){b=this.get(b);return darwino.Utils.isNumber(b)?b:null};a.prototype.getBoolean=function(b){b=this.get(b);return darwino.Utils.isBoolean(b)?b:null};a.prototype.getDate=function(b){b=this.get(b);if(darwino.Utils.isString(b))try{return darwino.Utils.stringToDate(b)}catch(a){throw new c.JsonException("Error while parsing an ISO date");
}return null};a.prototype.getDocumentUrl=function(){var b=this.getSession().getUrlBuilder();return b?b.getDocumentUrl(this.getDatabase().getId(),this.getStore().getId(),this.getUnid()):null};a.prototype.getAttachmentUrl=function(b){var a=this.getSession().getUrlBuilder();return a?a.getAttachmentUrl(this.getDatabase().getId(),this.getStore().getId(),this.getUnid(),b):null};a.prototype.findSubQueryEntries=function(b,a){var d=this._cursor.findSubQuery(b);if(d){for(var f=this._entry[b],g=0,e=0;e<f.length;e++){var h=
new c._RemoteCursorEntry(d.cursor,f[e]);a.handle(h);0!=(d.cursor._options&c.Cursor.RANGE_ROOT)&&0!=h.getHierarchicalLevel()||g++}return g}return 0};c._RemoteCursorEntry=a});
darwino.provide("darwino/jstore/remote/database",null,function(){function a(a,b,c,d){this._session=a;this._client=b;this._name=c;this._instance=d}var d=darwino.install("jstore");a.prototype.getHttpStoreClient=function(){return this._client};a.prototype.getSession=function(){return this._session};a.prototype.getUserContext=function(){this._getDatabaseDef();return this._userContext};a.prototype.getInstance=function(){return this._instance};a.prototype.getReplicationIdentifier=function(){return this._getDatabaseDef().replicationIdentifier};
a.prototype.getId=function(){return this._name};a.prototype.getLabel=function(){return this._getDatabaseDef().label};a.prototype.getReplicaId=function(){return this._getDatabaseDef().replicaId};a.prototype.getVersion=function(){return this._getDatabaseDef().version};a.prototype.getTimeZone=function(){return this._getDatabaseDef().timeZone};a.prototype.canReadDocument=function(){return"canReadDocument"in this._getDatabaseDef()?this._getDatabaseDef().canReadDocument:!0};a.prototype.canCreateDocument=
function(){return"canCreateDocument"in this._getDatabaseDef()?this._getDatabaseDef().canCreateDocument:!0};a.prototype.canUpdateDocument=function(){return"canUpdateDocument"in this._getDatabaseDef()?this._getDatabaseDef().canUpdateDocument:!0};a.prototype.canDeleteDocument=function(){return"canDeleteDocument"in this._getDatabaseDef()?this._getDatabaseDef().canDeleteDocument:!0};a.prototype.canManage=function(){return"canManage"in this._getDatabaseDef()?this._getDatabaseDef().canManage:!0};a.prototype.isReplicationEnabled=
function(){return this._getDatabaseDef().replicationEnabled};a.prototype.isInstanceEnabled=function(){return this._getDatabaseDef().instanceEnabled};a.prototype.isJsonQuerySupported=function(){this._getDatabaseDef();return this._jsonQuery};a.prototype.getDocumentSecurity=function(){return this._getDatabaseDef().documentSecurity};a.prototype.isFtSearchEnabled=function(){this._getDatabaseDef();return this._ftSearch};a.prototype.updateFtSearchIndex=function(a){this.getHttpStoreClient().updateFtSearchIndex(this._name,
a)};a.prototype.storeExists=function(a){var b=this._getDatabaseDef().stores;return b&&b[a]};a.prototype.getStore=function(a){return new d._RemoteStore(this,a)};a.prototype.getStoreList=function(){var a=this._getDatabaseDef().stores;if(a){var b=[],c;for(c in a)b.push(c);return b}return[]};a.prototype.documentCount=function(){return this.getHttpStoreClient().databaseDocumentCount(this._name).count};a.prototype.documentExistsById=function(a){return this.getHttpStoreClient().documentExistsById(this._name,
a).exists};a.prototype.loadDocumentById=function(a,b,c){a=this.getHttpStoreClient().loadDocumentById(this._name,a,b);b=this.getStore(a.store);b=new d._RemoteDocument(b,null);b.updateJson(a);if(c)c.handle(b);else return b};a.prototype.deleteDocumentById=function(a,b){return this.getHttpStoreClient().deleteDocumentById(this._name,a,b)};a.prototype.deleteAllDocuments=function(a,b){this.getHttpStoreClient().deleteAllDatabaseDocuments(this._name,a,b)};a.prototype.getReplication=function(){throw new d.JsonException("Replication capabilities are not enabled for HTTP access");
};a.prototype.getJsonMetadata=function(){return this._getDatabaseDef()};a.prototype._getDatabaseDef=function(){var a=this._session._application._getDatabaseDef(this._session.getUser().getDistinguishedName(),this._name,this._instance.getId());if(!a){a=this.getHttpStoreClient().getDatabaseMetaData(this._name,this._instance.getId(),!0);if(!a)throw new d.JsonException("Database {0} does not exist",this._name);if("canReadDocument"in a&&!a.canReadDocument)throw new d.JsonException("Cannot access database {0}",
_name);this._session._application._putDatabaseDef(this._session.getUser().getDistinguishedName(),this._name,this._instance.getId(),a);var b=a.sessionData,c=b.database;this._jsonQuery=c.jsonQuery||!1;this._ftSearch=c.ftSearch||!1;b=b.userContext;this._userContext=new d._RemoteUserContext(this._session.getUser(),b.securityEnabled,b.entries)}return a};d._RemoteDatabase=a});
darwino.provide("darwino/jstore/remote/document",null,function(){function b(a,b){this._store=a;this._unid=b;this._json={};this._replicaId=a._database.getReplicaId();this._updateId=this._seqId=this._id=0;this._changes=this._muser=this._mdate=this._cuser=this._cdate=null;this._attachments=[]}var c=darwino.install("jstore");b.STORE_UNID_SEP=":";b.prototype.getHttpStoreClient=function(){return this._store.getHttpStoreClient()};b.prototype.getSession=function(){return this._store._database._session};b.prototype.getDatabase=
function(){return this._store._database};b.prototype.getStore=function(){return this._store};b.prototype.getDocId=function(){return this._id};b.prototype.getUnid=function(){return this._unid};b.prototype.getReplicaId=function(){return this._replicaId};b.prototype.getCreationDate=function(){return this._cdate};b.prototype.getCreationUser=function(){return this._cuser};b.prototype.getLastModificationDate=function(){return this._mdate};b.prototype.getLastModificationUser=function(){return this._muser};
b.prototype.getETag=function(){return this._unid&&this._mdate?this._unid+"-"+this._mdate.getTime().toString(16):null};b.prototype.getChanges=function(){return this._changes};b.prototype.getSeqId=function(){return this._seqId};b.prototype.getUpdateId=function(){return this._updateId};b.prototype.getParentUnid=function(){return this.getString(c.Document.SYSTEM_PARENTID)};b.prototype.setParentUnid=function(a){a?this.set(c.Document.SYSTEM_PARENTID,a):this.remove(c.Document.SYSTEM_PARENTID);return this};
b.prototype.getParent=function(){var a=this.getString(c.Document.SYSTEM_PARENTID);if(a){var b=a.indexOf(c.Document.STORE_UNID_SEP);if(0<=b){var d=a.substring(b+1),a=a.substring(0,b);return this.getDatabase().getStore(d).loadDocument(a)}return this.getStore().loadDocument(a)}return null};b.prototype.setParent=function(a){a?a._store.getId()==this._store.getId()?this.setParentUnid(a.getUnid()):this.setParentUnid(a.getUnid()+c.Document.STORE_UNID_SEP+a._store.getId()):this.setParentUnid(null);return this};
b.prototype.getSyncMasterUnid=function(){return this.getString(c.Document.SYSTEM_SYNCMASTERID)};b.prototype.setSyncMasterUnid=function(a){a?this.set(c.Document.SYSTEM_SYNCMASTERID,a):this.remove(c.Document.SYSTEM_SYNCMASTERID);return this};b.prototype.getSyncMaster=function(){var a=this.getString(c.Document.SYSTEM_SYNCMASTERID);if(a){var b=a.indexOf(c.Document.STORE_UNID_SEP);if(0<=b){var d=a.substring(b+1),a=a.substring(0,b);return this.getDatabase().getStore(d).loadDocument(a)}return this.getStore().loadDocument(a)}return this};
b.prototype.setSyncMaster=function(a){a?a._store.getId()==this._store.getId()?this.setSyncMasterUnid(a.getUnid()):this.setSyncMasterUnid(a.getUnid()+c.Document.STORE_UNID_SEP+a.getStore().getId()):this.setSyncMasterUnid(null);return this};b.prototype.childrenCount=function(){return this.isNewDocument()?0:this._store.childrenCount(this._unid)};b.prototype.getChildren=function(){return this.getHttpStoreClient().getChildren(this._store._database._name,this._store._name,this._unid)};b.prototype.getSyncSlaves=
function(){return this.getHttpStoreClient().getSyncSlaves(this._store._database._name,this._store._name,this._unid)};b.prototype.isNewDocument=function(){return 0==this._id};b.prototype.save=function(a){a=this.getHttpStoreClient().save(this._store._database._name,this._store._name,this._id,this._unid,a,this.asJson(c.Document.JSON_DOCUMENT|c.Document.JSON_UPDATEDATTACHMENTS|c.Document.JSON_ATTACHMENTCONTENT),null);this.updateJson(a);this.getStore().clearSocialDataCache(this.getUnid())};b.prototype.deleteDocument=
function(a){this.getHttpStoreClient().deleteDocument(this._store._database._name,this._store._name,this._unid,a);this.getStore().clearSocialDataCache(this.getUnid())};b.prototype.isShared=function(){return this._store.isShared(this._unid,null)};b.prototype.share=function(a){return this._store.share(this._unid,a,null)};b.prototype.getShareCount=function(){return this._store.getShareCount(this._unid)};b.prototype.getRate=function(){return this._store.getRate(this._unid,null)};b.prototype.rate=function(a){return this._store.rate(this._unid,
a,null)};b.prototype.getRateAvg=function(){return this._store.getRateAvg(this._unid)};b.prototype.isRead=function(){return this._store.isRead(this._unid,null)};b.prototype.markRead=function(a){return this._store.markRead(this._unid,a,null)};b.prototype.getReadCount=function(){return this._store.getReadCount(this._unid)};b.prototype.canUpdateDocument=function(){return!0};b.prototype.canDeleteDocument=function(){return!0};b.prototype.getJson=function(){return this._json};b.prototype.getJsonString=function(a){return this._store._database._session.toJson(this._json,
a)};b.prototype.setJson=function(a){if(!a)throw new c.JsonException("Cannot assign a null JSON value to a document, {0}",this);this._json=a;return this};b.prototype.setJsonString=function(a){return this.setJson(this._store._database._session.fromJson(a))};b.prototype.get=function(a){if(darwino.Utils.isObject(this._json))return this._json[a];throw new c.JsonException("The JSON data is not an object");};b.prototype.getString=function(a){a=this.get(a);return darwino.Utils.isString(a)?a:null};b.prototype.getInt=
function(a){a=this.get(a);return darwino.Utils.isNumber(a)?a:null};b.prototype.getLong=function(a){a=this.get(a);return darwino.Utils.isNumber(a)?a:null};b.prototype.getDouble=function(a){a=this.get(a);return darwino.Utils.isNumber(a)?a:null};b.prototype.getBoolean=function(a){a=this.get(a);return darwino.Utils.isBoolean(a)?a:null};b.prototype.getDate=function(a){a=this.get(a);if(darwino.Utils.isString(a))try{return darwino.Utils.stringToDate(a)}catch(b){throw new c.JsonException("Error while parsing an ISO date");
}return null};b.prototype.set=function(a,b){if(!this._json)this._json={};else if(!darwino.Utils.isObject(this._json))throw new c.JsonException("Root document value is not a Json object");if(darwino.Utils.isDate(b))try{b=darwino.Utils.dateToString(b)}catch(d){throw new c.JsonException("Error while converting an ISO date {0}",b);}this._json[a]=b;return this};b.prototype.remove=function(a){if(this._json){if(!darwino.Utils.isObject(this._json))throw new c.JsonException("Root document value is not a Json object");
delete this._json[a]}return this};b.prototype.jsonPath=function(a){if(darwino.Utils.isString(a))return darwino.Utils.jsonPath(this._json,a,null);throw new c.JsonException("Object is not a valid json path. Should be a String");};b.prototype.compile=function(a){if(darwino.Utils.isString(a))return a;throw new c.JsonException("Object is not a valid json path. Should be a String");};b.prototype.getAttachmentCount=function(){return this._attachments.length};b.prototype.getAttachments=function(){return this._attachments};
b.prototype.getAttachment=function(a){for(var b=0;b<this._attachments.length;b++){var c=this._attachments[b];if(c._name==a)return c}return null};b.prototype.attachmentExists=function(a){return null!=this.getAttachment(a)};b.prototype.createAttachment=function(a,b){if(this.getAttachment(a))throw new c.JsonException(null,"Attachment {0} already exists, {1}",a,toString());var d=new c._RemoteAttachment(this,a,b);this._attachments.push(d);return d};b.prototype.deleteAllAttachments=function(a){a=this._attachments;
this._attachments=[];if(!this.isNewDocument())for(var b=0;b<a.length;b++){var d=a[b];d._dbOperation!=c.Attachment.OP_CREATED&&(d.deleteAttachment(),this._attachments.push(d))}};b.prototype.asJson=function(a){var b={};b.store=this._store._id;this._id&&(b.id=this._id);this._unid&&(b.unid=this._unid);this._replicaId&&(b.replicaId=this._replicaId);this._seqId&&(b.seqId=this._seqId);this._updateId&&(b.updateId=this._updateId);this._cdate&&(b.cdate=this._cdate.getTime());this._cuser&&(b.cuser=this._cuser);
this._mdate&&(b.mdate=this._mdate.getTime());this._muser&&(b.muser=this._muser);this._changes&&(b.changes=this._changes);0!=(a&c.Document.JSON_DOCUMENT)&&this._json&&(b.json=this._json);if(0!=(a&(c.Document.JSON_ALLATTACHMENTS|c.Document.JSON_UPDATEDATTACHMENTS))&&0<this._attachments.length){for(var d=[],g=0;g<this._attachments.length;g++){var e=this._attachments[g];if(0!=(a&c.Document.JSON_ALLATTACHMENTS)||e._dbOperation!=c.Attachment.OP_NOOP){var f={};e._dbOperation&&(f.op=e._dbOperation);e._seqId&&
(f.seqId=e._seqId);e._mdate&&(f.mdate=e._mdate.getTime());e._name&&(f.name=e._name);e._length&&(f.length=e._length);e._mimeType&&(f.mimeType=e._mimeType);0!=(a&c.Document.JSON_ATTACHMENTCONTENT)&&e._dbOperation!=c.Attachment.OP_DELETED&&(f.content=e.readAsBase64());0!=(a&c.Document.JSON_ATTACHMENTURL)&&(f.url=e.getAttachmentUrl());d.push(f)}}0<d.length&&(b.attachments=d)}return b};b.prototype.updateJson=function(a){this._id=a.id||0;this._unid=a.unid;this._replicaId=a.replicaId;this._seqId=a.seqId||
0;this._updateId=a.updateId;this._cdate=a.cdate?new Date(a.cdate):null;this._cuser=a.cuser;this._mdate=a.mdate?new Date(a.mdate):null;this._muser=a.muser;this._changes=a.changes;this._json=a.json;this._attachments=[];if(a=a.attachments)for(var b=0;b<a.length;b++){var d=a[b],g=d.op||c.Attachment.OP_NOOP,e=d.seqId||0,f=new Date(d.mdate),m=d.name,h=d.length||0,k=d.mimeType,l=null;(d=d.content)&&(l=darwino.Utils.createBinaryContent(k,darwino.Utils.atob(d),h));e=new c._RemoteAttachment(this,m,l,h,k,e,
new Date(f));e._dbOperation=g;this._attachments.push(e)}return this};b.prototype.getDocumentUrl=function(){var a=this.getSession().getUrlBuilder();return a?a.getDocumentUrl(this.getDatabase().getId(),this.getStore().getId(),this.getUnid()):null};b.prototype.getAttachmentUrl=function(a){var b=this.getSession().getUrlBuilder();return b?b.getAttachmentUrl(this.getDatabase().getId(),this.getStore().getId(),this.getUnid(),a):null};c._RemoteDocument=b});
darwino.provide("jstore/remote/httpapplication",null,function(){function b(a){this._databaseDefs={};this._urlBuilder=new c._UrlBuilder(a)}var c=darwino.install("jstore"),d=null;b.prototype.close=function(){};b.prototype.createSession=function(a){var e=new darwino.Utils._JsonHttpClient(this._urlBuilder.getBaseUrl()),e=new c._HttpStoreClient(e,a);return new c._RemoteSession(e,this,a)};b.prototype.createBasicSession=function(a,e,b){a=new darwino.Utils._JsonHttpClient(this._urlBuilder.getBaseUrl(),a,
e);a=new c._HttpStoreClient(a,b);return new c._RemoteSession(a,this,b)};b.prototype._getDatabaseDef=function(a,b,c){return this._databaseDefs[b+"|"+a+"|"+c]};b.prototype._putDatabaseDef=function(a,b,c,d){this._databaseDefs[b+"|"+a+"|"+c]=d};b.prototype._createInstance=function(a){if(a)return new darwino.jstore._RemoteInstance(a);d||(d=new darwino.jstore._RemoteInstance(""));return d};c.createRemoteApplication=function(a){return new b(a)}});
darwino.provide("darwino/jstore/remote/httpstoreclient",null,function(){function c(a,b){this._jsonClient=a;this._instanceName=b}function l(a,b){a._ftSearch&&(b.ftsearch=a._ftSearch);a._unid&&(b.unid=a._unid);a._parentId&&(b.parentid=a._parentId);a._key&&(b.key=darwino.Utils.toJson(a._key));a._partialKey&&(b.partialkey=darwino.Utils.toJson(a._partialKey));a._tags&&(b.tags=a._tags.join());a._startKey&&(b.startkey=darwino.Utils.toJson(a._startKey),a._excludeStart&&(b.excludestart=!0));null!=a._endKey&&
(b.endkey=darwino.Utils.toJson(a._endKey),a._excludeEnd&&(b.excludeend=!0));if(0<a._skip||0<a._limit)b.skip=Math.max(0,a._skip),b.limit=Math.max(0,a._limit);0<a._hierarchical&&(b.hierarchical=a._hierarchical);a._hierarchySources&&(b.hierarchysources=a._hierarchySources.join());a._orderBy&&(b.orderby=!0);a._categoryCount&&(b.categoryCount=!0);a._categoryStart&&(b.categoryStart=!0);a._descending&&(b.descending=!0);0<a._options&&(b.options=a._options);a._query&&(b.query=darwino.Utils.toJson(darwino.Utils.fromJson(a._query)));
a._extract&&(b.extract=darwino.Utils.toJson(darwino.Utils.fromJson(a._extract)));a._agg&&(b.aggregator=darwino.Utils.toJson(darwino.Utils.fromJson(a._agg)));return b}var m=darwino.install("jstore");c.prototype.queryString=function(a){a={};void 0!=this._instanceName&&null!=this._instanceName&&(a.instance=this._instanceName);return a};c.prototype.getHttpClient=function(){return this._jsonClient};c.prototype.getUserImpl=function(){var a=this.queryString(),a=this._jsonClient.getAsJson(["user"],a);return new m._User(a.dn,
a.cn,a.groups,a.roles)};c.prototype.getDatabaseList=function(){for(var a=this.queryString(),a=this._jsonClient.getAsJson(["databases"],a),b=Array(a.length),d=0;d<b.length;d++)b[d]=a[d].id;return b};c.prototype.deployDatabase=function(a,b,d,e){var c={};0<b&&(c.version=b);e&&(c.force=e);return this._jsonClient.postJsonAsEmpty(["databases",a,"deploy"],c,d)};c.prototype.undeployDatabase=function(a){return this._jsonClient.getAsEmpty(["databases",a,"undeploy"])};c.prototype.resetDatabase=function(a){return this._jsonClient.getAsEmpty(["databases",
a,"reset"])};c.prototype.getDatabaseMetaData=function(a,b,d){b={instance:b||""};d&&(b.sessiondata=d);return this._jsonClient.getAsJson(["databases",a],b)};c.prototype.databaseDocumentCount=function(a){var b=this.queryString();return this._jsonClient.getAsJson(["databases",a,"documentscount"],b)};c.prototype.deleteAllDatabaseDocuments=function(a,b,d){var e=this.queryString();0<d&&(e.before=d);b&&(e.options=b);return this._jsonClient.deleteAsJson(["databases",a,"documents"],e)};c.prototype.deleteDocument=
function(a,b,d,e){var c=this.queryString();e&&(c.options=e);return this._jsonClient.deleteAsJson(["databases",a,"stores",b,"documents",d],c)};c.prototype.deleteDocumentById=function(a,b,d){var e=this.queryString();d&&(e.options=d);return this._jsonClient.deleteAsJson(["databases",a,"documents",b],e)};c.prototype.deleteAllDocuments=function(a,b,d,e,c){var f=this.queryString();0<c&&(f.before=c);e&&(f.options=e);return d?this._jsonClient.deleteAsJson(["databases",a,"stores",b,"indexes",d,"documents"],
f):this._jsonClient.deleteAsJson(["databases",a,"stores",b,"documents"],f)};c.prototype.updateFtSearchIndex=function(a,b){var d=this.queryString();b&&(d.async=!0);return this._jsonClient.getAsEmpty(["databases",a,"updateftindex"],d)};c.prototype.documentExists=function(a,b,d){var e=this.queryString();return this._jsonClient.getAsJson(["databases",a,"stores",b,"documentexists",d],e)};c.prototype.documentExistsById=function(a,b){var d=this.queryString();return this._jsonClient.getAsJson(["databases",
a,"documentexists",b],d)};c.prototype.documentExistsByIndex=function(a,b,d,e){var c=this.queryString();e=darwino.Utils.toJson(e);return this._jsonClient.getAsJson(["databases",a,"stores",b,"indexes",d,"documentexists",e],c)};c.prototype.documentDeleted=function(a,b,d){var e=this.queryString();return this._jsonClient.getAsJson(["databases",a,"stores",b,"documentdeleted",d],e)};c.prototype.documentCount=function(a,b,d){d=this.queryString();return this._jsonClient.getAsJson(["databases",a,"stores",b,
"documentscount"],d)};c.prototype.getDocuments=function(a,b){var d=this.queryString();return this._jsonClient.getAsJson(["databases",a,"stores",b,"documentids"],d)};c.prototype.childrenCount=function(a,b,d){var e=this.queryString();return this._jsonClient.getAsJson(["databases",a,"stores",b,"childrencount",d],e)};c.prototype.getChildren=function(a,b,d){var e=this.queryString();return this._jsonClient.getAsJson(["databases",a,"stores",b,"children",d],e)};c.prototype.getSyncSlaves=function(a,b,d){var e=
this.queryString();return this._jsonClient.getAsJson(["databases",a,"stores",b,"syncslaves",d],e)};c.prototype.loadDocument=function(a,b,d,e){var c=this.queryString();e&&(c.options=e);return this._jsonClient.getAsJson(["databases",a,"stores",b,"documents",d],c)};c.prototype.loadDocumentById=function(a,b,d){var e=this.queryString();d&&(e.options=d);return this._jsonClient.getAsJson(["databases",a,"documents",b],e)};c.prototype.loadDocumentByIndex=function(a,b,d,e,c){var f=this.queryString();c&&(f.options=
c);e=darwino.Utils.toJson(e);return this._jsonClient.getAsJson(["databases",a,"stores",b,"indexes",d,"documents",e],f)};c.prototype.getTags=function(a,b,d,e){var c=this.queryString();0<d&&(c.maxtags=d);e&&(c.sortbyname=!0);return this._jsonClient.getAsJson(["databases",a,"stores",b,"tags"],c)};c.prototype.getSocialData=function(a,b,d,c){var g=this.queryString();c&&(g.user=c);return this._jsonClient.getAsJson(["databases",a,"stores",b,"documents",d,"social"],g)};c.prototype.updateSocialData=function(a,
b,d,c,g,f,h){var k=this.queryString();h&&(k.user=h);null!=c&&(k.share=c);null!=g&&(k.read=g);null!=f&&(k.rate=f);return this._jsonClient.putEmptyAsJson(["databases",a,"stores",b,"documents",d,"social"],k)};c.prototype.save=function(a,b,d,c,g,f){var h=this.queryString();g&&(h.options=g);return f=0==d?c?this._jsonClient.postJsonAsJson(["databases",a,"stores",b,"documents",c],h,f):this._jsonClient.postJsonAsJson(["databases",a,"stores",b,"documents"],h,f):this._jsonClient.putJsonAsJson(["databases",
a,"stores",b,"documents",c],h,f)};c.prototype.deleteByUnid=function(a,b,d,c){var g=this.queryString();c&&(g.options=c);return this._jsonClient.deleteAsJson(["databases",a,"stores",b,"documents",d],g)};c.prototype.count=function(a,b){var d=this.queryString();b&&(d.limit=!0);return this._cursorAsJson(a,"count",d)};c.prototype.findIds=function(a){var b=this.queryString();return this._cursorAsJson(a,"ids",b)};c.prototype.deleteCursor=function(a,b){var d=l(a,this.queryString());b&&(d.options=b);a.getIndex()?
this._jsonClient.getAsEmpty(["databases",a.getDatabase().getId(),"stores",a.getStore().getId(),"indexes",a.getIndex().getId(),"deleteall"],d):this._jsonClient.getAsEmpty(["databases",a.getDatabase().getId(),"stores",a.getStore().getId(),"deleteall"],d)};c.prototype.markAllRead=function(a,b,d){var c=l(a,this.queryString());c.read=b;d&&(c.user=d);null!=a.getIndex()?this._jsonClient.getAsEmpty(["databases",a.getDatabase().getId(),"stores",a.getStore().getId(),"indexes",a.getIndex().getId(),"markallread"],
c):this._jsonClient.getAsEmpty(["databases",a.getDatabase().getId(),"stores",a.getStore().getId(),"markallread"],c)};c.prototype.findOneJson=function(a){var b=this.queryString();return this._cursorAsJson(a,"entry",b)};c.prototype.findJson=function(a){var b=this.queryString();return this._cursorAsJson(a,"entries",b)};c.prototype.findJsonTree=function(a){var b=this.queryString();b.jsontree=!0;return this._cursorAsJson(a,"entries",b)};c.prototype._cursorAsJson=function(a,b,c){if(this.cursorAsGet())return c=
l(a,c),a.getIndex()?this._jsonClient.getAsJson(["databases",a.getDatabase().getId(),"stores",a.getStore().getId(),"indexes",a.getIndex().getId(),b],c):this._jsonClient.getAsJson(["databases",a.getDatabase().getId(),"stores",a.getStore().getId(),b],c);var e=a.toJson();return a.getIndex()?this._jsonClient.postJsonAsJson(["databases",a.getDatabase().getId(),"stores",a.getStore().getId(),"indexes",a.getIndex().getId(),b],c,e):this._jsonClient.postJsonAsJson(["databases",a.getDatabase().getId(),"stores",
a.getStore().getId(),b],c,e)};c.prototype.cursorAsGet=function(){return!1};c.prototype.readAttachment=function(a,b,c,e){var g=this.queryString();return this._jsonClient.getAsBinaryString(["databases",a,"stores",b,"documents",c,"attachments",e],g)};m._HttpStoreClient=c});
darwino.provide("darwino/jstore/remote/index",null,function(){function a(a,b){this._store=a;this._name=b}var b=darwino.install("jstore");a.prototype.getHttpStoreClient=function(){return this._store.getHttpStoreClient()};a.prototype._getIndexDef=function(){var a=this._store._getStoreDef().indexes;if(a&&(a=a[this._name]))return a;throw new b.JsonException("Cannot find index {0} in store {1} in database {2}",this._name,this._store._name,this._store._database._name);};a.prototype.getSession=function(){return this._store.getSession()};
a.prototype.getDatabase=function(){return this._store.getDatabase()};a.prototype.getStore=function(){return this._store};a.prototype.getId=function(){return this._name};a.prototype.getLabel=function(){return this._getIndexDef().label};a.prototype.getCategoryCount=function(){return this._getIndexDef().categoryCount};a.prototype.deleteAllDocuments=function(a,b){return this.getHttpStoreClient().deleteAllDocuments(this._store._database._name,this._store._name,this._name,a,b)};a.prototype.openCursor=function(){return new b._RemoteCursor(this._store,
this)};b._RemoteIndex=a});
darwino.provide("darwino/jstore/remote/instance",null,function(){function a(a){this._id=a||""}var b=darwino.install("jstore");a.prototype.getId=function(){return this._id};b._RemoteInstance=a});
darwino.provide("darwino/jstore/remote/session",null,function(){function a(a,c,b){this._client=a;this._application=c;this._instance=b;this._databases={}}var e=darwino.install("jstore");a.prototype.getHttpStoreClient=function(){return this._client};a.prototype.clone=function(){return new a(this.getHttpStoreClient(),this._application)};a.prototype.close=function(){};a.prototype.notifyChanges=function(){};a.prototype.getInstanceId=function(){return this._instance};a.prototype.releaseConnections=function(){};
a.prototype.isRemote=function(){return!0};a.prototype.isAsync=function(){return this.getHttpStoreClient().isAsync()};a.prototype.toJson=function(a,c){return darwino.Utils.toJson(a,2==arguments.length?c:!0)};a.prototype.fromJson=function(a){return darwino.Utils.fromJson(a)};a.prototype.getUser=function(){this._user||(this._user=this.getHttpStoreClient().getUserImpl());return this._user};a.prototype.isSecurityEnabled=function(){return!0};a.prototype.supportTransaction=function(){return!1};a.prototype.startTransaction=
function(){};a.prototype.commitTransaction=function(){};a.prototype.abortTransaction=function(){throw new e.JsonException("An HTTP transaction cannot be aborted!");};a.prototype.endTransaction=function(a){};a.prototype.getDatabase=function(a,c){var b;void 0==c?(c=this._instance,b=this._client):b=new e._HttpStoreClient(this._client.getHttpClient(),c);var d=this._application._createInstance(c);return new e._RemoteDatabase(this,b,a,d)};a.prototype.getDatabaseList=function(){return this.getHttpStoreClient().getDatabaseList()};
a.prototype.databaseExists=function(a){for(var c=this.getHttpStoreClient().getDatabaseList(),b=0;b<c.length;b++)if(darwino.Utils.equalsIgnoreCase(c[b],a))return!0;return!1};a.prototype.deployDatabase=function(a,c,b,d){darwino.Utils.isString(b)&&(b=darwino.Utils.fromJson(b));this.getHttpStoreClient().deployDatabase(a,c,b,d)};a.prototype.undeployDatabase=function(a){this.getHttpStoreClient().undeployDatabase(a)};a.prototype.resetDatabase=function(a){this.getHttpStoreClient().resetDatabase(a)};a.prototype.getUrlBuilder=
function(){return this._application._urlBuilder};a.prototype.readAttachment=function(a,c,b,d){return this.getHttpStoreClient().readAttachmentStream(a,c,b,d)};e._RemoteSession=a});
darwino.provide("darwino/jstore/remote/store",null,function(){function b(a,c){this._database=a;this._name=c;this._social={}}var d=darwino.install("jstore");b.prototype.getHttpStoreClient=function(){return this._database.getHttpStoreClient()};b.prototype._getStoreDef=function(){var a=this._database._getDatabaseDef().stores;if(a&&(a=a[this._name]))return a;throw new d.JsonException("Cannot find store {0} in database {1}",this._name,this._database._id);};b.prototype.getSession=function(){return this._database._session};
b.prototype.getDatabase=function(){return this._database};b.prototype.getId=function(){return this._getStoreDef().id};b.prototype.getLabel=function(){return this._getStoreDef().label};b.prototype.isFtSearchEnabled=function(){return this._getStoreDef().fulltextEnabled&&this._database.isFtSearchEnabled()};b.prototype.isTaggingEnabled=function(){return this._getStoreDef().taggingEnabled};b.prototype.isReadMarkEnabled=function(){return this._getStoreDef().readMarkEnabled};b.prototype.deleteDocument=function(a,
c){return this.getHttpStoreClient().deleteDocument(this._database._name,this._name,a,c)};b.prototype.deleteAllDocuments=function(a,c){return this.getHttpStoreClient().deleteAllDocuments(this._database._name,this._name,null,a,c)};b.prototype.documentExists=function(a){return this.getHttpStoreClient().documentExists(this._database._name,this._name,a).exists};b.prototype.documentExistsByIndex=function(a,c){return this.getHttpStoreClient().documentExistsByIndex(this._database._name,this._name,a,c).exists};
b.prototype.documentDeleted=function(a){return this.getHttpStoreClient().documentDeleted(this._database._name,this._name,a).deleted};b.prototype.documentCount=function(){return this.getHttpStoreClient().documentCount(this._database._name,this._name).count};b.prototype.getDocuments=function(){return this.getHttpStoreClient().getDocuments(this._database._name,this._name)};b.prototype.childrenCount=function(a){return this.getHttpStoreClient().childrenCount(this._database._name,this._name,a).count};b.prototype.getChildren=
function(a){return this.getHttpStoreClient().getChildren(this._database._name,this._name,a)};b.prototype.getSyncSlaves=function(a){return this.getHttpStoreClient().getSyncSlaves(this._database._name,this._name,a)};b.prototype.newDocument=function(a){a||(a=darwino.Utils.uuid());return new d._RemoteDocument(this,a)};b.prototype.loadDocument=function(a,c,b){c=this.getHttpStoreClient().loadDocument(this._database._name,this._name,a,c);a=new d._RemoteDocument(this,a);a.updateJson(c);this.clearSocialDataCache(a.getUnid());
if(b)b.handle(a);else return a};b.prototype.loadDocumentByIndex=function(a,c,b,e){a=this.getHttpStoreClient().loadDocumentByIndex(this._database._name,this._name,a,c,b);c=new d._RemoteDocument(this,this.unid);c.updateJson(a);this.clearSocialDataCache(c.getUnid());if(e)e.handle(c);else return c};b.prototype.getTags=function(a,c){return this.getHttpStoreClient().getTags(this._database._name,this._name,a,c)};b.prototype.clearSocialDataCache=function(a){a?delete this._social[a]:this._social={}};b.prototype.isShared=
function(a,c){return this._getSocialData(a,c).share};b.prototype.share=function(a,c,b){c=this.getHttpStoreClient().updateSocialData(this._database._name,this._name,a,c,null,null,b);this._updateAggregatedData(a,b,c)};b.prototype.getShareCount=function(a){return this._getSocialData(a,null).shareCount};b.prototype.getRate=function(a,c){return this._getSocialData(a,c).rate};b.prototype.rate=function(a,c,b){c=this.getHttpStoreClient().updateSocialData(this._database._name,this._name,a,null,null,c,b);this._updateAggregatedData(a,
b,c)};b.prototype.getRateAvg=function(a){return this._getSocialData(a,null).rateAvg};b.prototype.isRead=function(a,c){return this._getSocialData(a,c).read};b.prototype.markRead=function(a,c,b){c=this.getHttpStoreClient().updateSocialData(this._database._name,this._name,a,null,c,null,b);this._updateAggregatedData(a,b,c)};b.prototype.getReadCount=function(a){return this._getSocialData(a,null).readCount};b.prototype.openCursor=function(a,c){return new d._RemoteCursor(this,null)};b.prototype.indexExists=
function(a){var c=this._getStoreDef().indexes;return c&&c[a]};b.prototype.getIndexList=function(a){if(a=this._getStoreDef().indexes){var c=[],b;for(b in a)c.push(b);return c}return[]};b.prototype.getIndex=function(a){return new d._RemoteIndex(this,a)};b.prototype._getSocialData=function(a,c){if(this._isCurrentUser(c)&&this._social){var b=this._social[a];if(b)return b}b=this.getHttpStoreClient().getSocialData(this._database._name,this._name,a,c);return this._updateAggregatedData(a,c,b)};b.prototype._updateAggregatedData=
function(a,b,d){this._isCurrentUser(b)?(b=this._social[a],b||(b={},this._social[a]=b)):b={};b.read=d.read;b.share=d.share;b.rate=d.rate;if(a=this._social[a])a.readCount=d.readCount,a.shareCount=d.shareCount,a.rateAvg=d.rateAvg;return b};b.prototype._isCurrentUser=function(a){if(!a)return!0;var b=this.getSession().getUser();return b.isAnonymous()||a&&a!=b.getDistinguishedName()?!1:!0};d._RemoteStore=b});
darwino.provide("darwino/jstore/remote/usercontext",null,function(){function a(b,a,c){this._user=b;this._securityEnabled=a;this._entries={};if(c)for(b=0;b<c.length;b++)this._entries[c[b]]=!0}var d=darwino.install("jstore");a.PEOPLE_PREFIX="p:";a.GROUP_PREFIX="g:";a.ROLE_PREFIX="r:";a.prototype.getUser=function(){return this._user};a.prototype.isSecurityEnabled=function(){return this._securityEnabled};a.prototype.getEntryNames=function(){var b=[],a;for(a in this._entries)b.push(a);return b};a.prototype.hasEntry=
function(a){return 1==this._entries[a]};a.prototype.hasUserId=function(a){return this._hasEntry(PEOPLE_PREFIX+a)};a.prototype.hasGroup=function(a){return this._hasEntry(GROUP_PREFIX+a)};a.prototype.hasRole=function(a){return this._hasEntry(ROLE_PREFIX+a)};d._RemoteUserContext=a});
darwino.provide("darwino/libs/base64",null,function(){var k=darwino.install("Utils"),h={PADCHAR:"\x3d",ALPHA:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",makeDOMException:function(){try{return new DOMException(DOMException.INVALID_CHARACTER_ERR)}catch(a){var b=Error("DOM Exception 5");b.code=b.number=5;b.name=b.description="INVALID_CHARACTER_ERR";b.toString=function(){return"Error: "+b.name+": "+b.message};return b}},getbyte64:function(a,b){var f=h.ALPHA.indexOf(a.charAt(b));
if(-1===f)throw h.makeDOMException();return f},decode:function(a){a=""+a;var b=h.getbyte64,f,c,d,e=a.length;if(0===e)return a;if(0!==e%4)throw h.makeDOMException();f=0;a.charAt(e-1)===h.PADCHAR&&(f=1,a.charAt(e-2)===h.PADCHAR&&(f=2),e-=4);var g=[];for(c=0;c<e;c+=4)d=b(a,c)<<18|b(a,c+1)<<12|b(a,c+2)<<6|b(a,c+3),g.push(String.fromCharCode(d>>16,d>>8&255,d&255));switch(f){case 1:d=b(a,c)<<18|b(a,c+1)<<12|b(a,c+2)<<6;g.push(String.fromCharCode(d>>16,d>>8&255));break;case 2:d=b(a,c)<<18|b(a,c+1)<<12,g.push(String.fromCharCode(d>>
16))}return g.join("")},getbyte:function(a,b){return a.charCodeAt(b)&255},encode:function(a){if(1!==arguments.length)throw new SyntaxError("Not enough arguments");var b=h.PADCHAR,f=h.ALPHA,c=h.getbyte,d,e,g=[];a=""+a;var k=a.length-a.length%3;if(0===a.length)return a;for(d=0;d<k;d+=3)e=c(a,d)<<16|c(a,d+1)<<8|c(a,d+2),g.push(f.charAt(e>>18)),g.push(f.charAt(e>>12&63)),g.push(f.charAt(e>>6&63)),g.push(f.charAt(e&63));switch(a.length-k){case 1:e=c(a,d)<<16;g.push(f.charAt(e>>18)+f.charAt(e>>12&63)+b+
b);break;case 2:e=c(a,d)<<16|c(a,d+1)<<8,g.push(f.charAt(e>>18)+f.charAt(e>>12&63)+f.charAt(e>>6&63)+b)}return g.join("")}};k.btoa=h.encode;k.atob=h.decode});
darwino.provide("darwino/libs/binary",null,function(){function a(a,b,c){this._mimeType=a;b?(this._content=b,this._length=void 0!=c?c:b.length):(this._content=null,this._length=0)}var d=darwino.install("Utils");a.prototype.getLength=function(){return this._length};a.prototype.getMimeType=function(){return this._mimeType};a.prototype.getAsBinaryString=function(){return this._content};a.prototype.getAsBase64=function(){return this._content?d.btoa(this._content):null};d.createBinaryContent=function(d,
b,c){return new a(d,b,c)}});
(function(){var d=!1,g=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){};Class.extend=function(b){function c(){!d&&this.init&&this.init.apply(this,arguments)}var e=this.prototype;d=!0;var f=new this;d=!1;for(var a in b)f[a]="function"==typeof b[a]&&"function"==typeof e[a]&&g.test(b[a])?function(a,b){return function(){var c=this._super;this._super=e[a];var d=b.apply(this,arguments);this._super=c;return d}}(a,b[a]):b[a];c.prototype=f;c.prototype.constructor=c;c.extend=arguments.callee;
return c}})();
darwino.provide("darwino/libs/jsonpath",null,function(){darwino.install("Utils").jsonPath=function(k,l,m){var e={resultType:m&&m.resultType||"VALUE",result:[],normalize:function(a){var b=[];return a.replace(/[\['](\??\(.*?\))[\]']/g,function(a,d){return"[#"+(b.push(d)-1)+"]"}).replace(/'?\.'?|\['?/g,";").replace(/;;;|;;/g,";..;").replace(/;$|'?\]|'$/g,"").replace(/#([0-9]+)/g,function(a,d){return b[d]})},asPath:function(a){a=a.split(";");for(var b="$",c=1,d=a.length;c<d;c++)b+=/^[0-9*]+$/.test(a[c])?
"["+a[c]+"]":"['"+a[c]+"']";return b},store:function(a,b){a&&(e.result[e.result.length]="PATH"==e.resultType?e.asPath(a):b);return!!a},trace:function(a,b,c){if(a){a=a.split(";");var d=a.shift();a=a.join(";");if(b&&b.hasOwnProperty(d))e.trace(a,b[d],c+";"+d);else if("*"===d)e.walk(d,a,b,c,function(a,c,d,b,f){e.trace(a+";"+d,b,f)});else if(".."===d)e.trace(a,b,c),e.walk(d,a,b,c,function(a,d,c,b,f){"object"===typeof b[a]&&e.trace("..;"+c,b[a],f+";"+a)});else if(/,/.test(d))for(var d=d.split(/'?,'?/),
h=0,f=d.length;h<f;h++)e.trace(d[h]+";"+a,b,c);else/^\(.*?\)$/.test(d)?e.trace(e.eval(d,b,c.substr(c.lastIndexOf(";")+1))+";"+a,b,c):/^\?\(.*?\)$/.test(d)?e.walk(d,a,b,c,function(a,c,d,b,f){e.eval(c.replace(/^\?\((.*?)\)$/,"$1"),b[a],a)&&e.trace(a+";"+d,b,f)}):/^(-?[0-9]*):(-?[0-9]*):?([0-9]*)$/.test(d)&&e.slice(d,a,b,c)}else e.store(c,b)},walk:function(a,b,c,d,e){if(c instanceof Array)for(var f=0,g=c.length;f<g;f++)f in c&&e(f,a,b,c,d);else if("object"===typeof c)for(f in c)c.hasOwnProperty(f)&&
e(f,a,b,c,d)},slice:function(a,b,c,d){if(c instanceof Array){var h=c.length,f=0,g=h,k=1;a.replace(/^(-?[0-9]*):(-?[0-9]*):?(-?[0-9]*)$/g,function(a,b,c,d){f=parseInt(b||f);g=parseInt(c||g);k=parseInt(d||k)});f=0>f?Math.max(0,f+h):Math.min(h,f);g=0>g?Math.max(0,g+h):Math.min(h,g);for(a=f;a<g;a+=k)e.trace(a+";"+b,c,d)}},eval:function(a,b,c){try{return n&&b&&eval(a.replace(/@/g,"_v"))}catch(d){throw new SyntaxError("jsonPath: "+d.message+": "+a.replace(/@/g,"_v").replace(/\^/g,"_a"));}}},n=k;if(l&&k&&
("VALUE"==e.resultType||"PATH"==e.resultType))return e.trace(e.normalize(l).replace(/^\$;/,""),k,"$"),e.result.length?e.result:!1}});
darwino.provide("darwino/libs/promise",null,function(){function b(a){this._isCanceled=this._isFulfilled=this._isRejected=!1;this.error=this.response=this._deferreds=null;a?a instanceof Error?this.rejected(a):this.fulfilled(a):this._deferreds=[]}var g=darwino.install("Utils");b.prototype.then=function(a,c){var d=new b;this._isFulfilled?this._fulfilled(a,c,d,this.data):this._isRejected?this._rejected(c,d,this.error):this._deferreds.push([a,c,d]);return d};b.prototype.cancel=function(a,c){this._isCanceled=
!0};b.prototype.isResolved=function(){return this._isRejected||this._isFulfilled};b.prototype.isRejected=function(){return this._isRejected};b.prototype.isFulfilled=function(){return this._isFulfilled};b.prototype.isCanceled=function(){return this._isCanceled};b.prototype.fulfilled=function(a){if(!this._isCanceled&&(this._isFulfilled=!0,this.data=a,this._deferreds))for(;0<this._deferreds.length;){var c=this._deferreds.shift();this._fulfilled(c[0],c[1],c[2],a)}};b.prototype.rejected=function(a){if(!this._canceled&&
(this._isRejected=!0,this.error=a,this._deferreds))for(;0<this._deferreds.length;){var c=this._deferreds.shift();this._rejected(c[1],c[2],a)}};b.prototype._fulfilled=function(a,c,d,e){if(a)try{var f=a(e);f instanceof b?f.then(function(a){d.fulfilled(a)},function(a){d.rejected(a)}):d.fulfilled(f)}catch(g){d.rejected(g)}else d.fulfilled(e)};b.prototype._rejected=function(a,c,b){if(a)try{var e=a(b);e||c.rejected(e)}catch(f){c.rejected(f)}else c.rejected(b)};g.promise=function(a){return new b(a)}});
darwino.provide("browser/jsonhttpclient",null,function(){function k(a){return null}function l(a){return a.responseText}function f(a){return g.fromJson(a.responseText)}function n(a){return g.parseXml(a.responseText)}function m(){var a=this.getResponseHeader("content-type");return"application/json"==a?f:"application/xml"==a?n:l}function c(a,b,d){this.async=this.USE_HTTP_OVERRIDE=!1;this._url=a;this._userName=b||null;this._password=d||null}var g=darwino.install("Utils");c.prototype.isError=function(a,
b){return 200!=a};c.prototype._makeUrl=function(a,b){var d=this._url;if(b&&b.length)var c=b.join("/"),d=g.concatPath(d,c);if(a){var c="",f;for(f in a)var h=a[f].toString(),c=c+((c?"\x26":"?")+encodeURIComponent(f)+(h?"\x3d"+encodeURIComponent(h):""));d=g.removeTrailingSep(d)+c}return d};c.prototype._ajax=function(a,b,d,c,f,h,g,k){var l=this;!this.USE_HTTP_OVERRIDE||"PUT"!=a&&"DELETE"!=a||(a="POST");if(this.async&&!h)throw Error("Empty callback parameter while executing an asynchronous request");b=
this._makeUrl(d,b);var e=new XMLHttpRequest;e.open(a,b,this.async,this.userName,this.password);e.onreadystatechange=function(){4==e.readyState&&h&&(l.isError(e.status,e)?h.failure&&h.failure(m(e)(e),e):(h.success||h)((g||m(e))(e),e))};k&&e.overrideMimeType(k);f?(c&&e.setRequestHeader("Content-Type",c),e.send(f)):e.send();if(!this.async&&!h){if(l.isError(e.status,e))throw Error("Error "+e.status+" while executing synchronous request");return(g||m(e))(e)}return null};c.prototype.getAsEmpty=function(a,
b,d){return this._ajax("GET",a,b,null,null,d,k)};c.prototype.getAsText=function(a,b,d){return this._ajax("GET",a,b,null,null,d,l)};c.prototype.getAsJson=function(a,b,d){return this._ajax("GET",a,b,null,null,d,f)};c.prototype.getAsXml=function(a,b,d){return this._ajax("GET",a,b,null,null,d,n)};c.prototype.getAsBinaryString=function(a,b,d){return this._ajax("GET",a,b,null,null,d,l,"text/plain; charset\x3dx-user-defined")};c.prototype.deleteAsEmpty=function(a,b,d){return this._ajax("DELETE",a,b,null,
null,d,k)};c.prototype.deleteAsJson=function(a,b,d){return this._ajax("DELETE",a,b,null,null,d,f)};c.prototype.putJsonAsJson=function(a,b,d,c){return this._ajax("PUT",a,b,"application/json",g.toJson(d),c,f)};c.prototype.putEmptyAsJson=function(a,b,d){return this._ajax("PUT",a,b,null,null,d,f)};c.prototype.postJsonAsEmpty=function(a,b,d,c){return this._ajax("POST",a,b,"application/json",g.toJson(d),c,k)};c.prototype.postJsonAsJson=function(a,b,d,c){return this._ajax("POST",a,b,"application/json",g.toJson(d),
c,f)};g._JsonHttpClient=c});
darwino.provide("hybrid/hybrid",null,function(){var b=0;if(navigator){var g=navigator.userAgent;/DarwinoHybrid\/[0-9\.]+ Android$/.test(g)?b=1:/DarwinoHybrid\/[0-9\.]+ iOS$/.test(g)&&(b=2)}var f=[];darwino.install("hybrid",{_settings:null,_init:function(){this._settings=0<b&&this.exec("readSettings")||{mode:0,dirty:!1}},isHybrid:function(){return 0<b},isHybridAndroid:function(){return 1==b},isHybridIos:function(){return 2==b},setSettingsValue:function(a,b){var e=this;setTimeout(function(){e._settings[a]=
b;for(var c=0;c<f.length;c++)f[c](a)})},addSettingsListener:function(a){f.push(a)},getProperty:function(a){return this._settings.props[a]},getMode:function(){return this._settings.mode},isDirty:function(){return this._settings.dirty},setDirty:function(a){this._settings.dirty=a},exec:function(a,d,e,c){d=d||{};return 1!=b||c?this._execHttp(a,d,e,c):this._execDirect(a,d,e,c)},_execHttp:function(a,b,e,c){a="$darwino-hybrid/rpc/"+encodeURI(a);a=new darwino.Utils._JsonHttpClient(a);c&&(a.async=!0);return a.postJsonAsJson(null,
null,b)},_execDirect:function(a,d,e,c){a={verb:a,args:d};if(1==b){a=JSON.parse(window.dwohybrid.exec(JSON.stringify(a)));if(200!=a.status)throw Error("Hybrid Call Error\x3d"+a.status+"\nMessage:"+a.message);return a.content}if(2==b)throw Error("Not Implemented yet on iOS!");throw Error("Unknown hybrid platform "+b);},refreshData:function(){this.isHybrid()?this.exec("refreshData"):location.reload()},switchToLocal:function(){this.exec("switchToLocal")},switchToRemote:function(){this.exec("switchToRemote")},
switchToWeb:function(){this.exec("switchToWeb")},createLocalData:function(){this.exec("createLocalData")},recreateLocalData:function(){this.exec("recreateLocalData")},deleteLocalData:function(){this.exec("deleteLocalData")},synchronizeData:function(){this.exec("synchronizeData")},eraseLocalData:function(){this.exec("eraseLocalData")},deleteLocalSqliteFile:function(){this.exec("deleteLocalSqliteFile")},startApplication:function(a){this.exec("startApplication",{name:a})},openSettings:function(){this.exec("openSettings")}});
darwino.hybrid._init()});
darwino.provide("darwino/social/social",null,function(){darwino.install("social")});
darwino.provide("darwino/social/profiles",null,function(){function b(a){this.profiles={};this.baseUrl=a;this.jsonClient=new darwino.Utils._JsonHttpClient(a);this.jsonClient.async=!0}var f=darwino.install("social"),e=null;b.prototype.isAnonymous=function(){return"anonymous"==this.getProfile("@me").id};b.prototype.isUnknown=function(){return"unknown"==this.getProfile("@me").id};b.prototype.getCurrentUser=function(a){e||(e={dn:"unknown",cn:"Unknown"},this.jsonClient.getAsJson(["user"],function(b){e=
b;a&&a()}));return e};b.prototype.getProfile=function(a,b){var c,d=this;a?(a=a.toLowerCase(),c=d.profiles[a],c||(d.profiles[a]={id:a,cn:a},d.jsonClient.getAsJson(["profile"],{id:a},function(c){d.profiles[a]=d.profiles[c.id.toLowerCase()]=c;c.email&&(d.profiles[c.email.toLowerCase()]=c);b&&b()}),c=d.profiles[a])):c={id:"anonymous",cn:"Anonymous"};return c||null};b.prototype.getProfilePhotoUrl=function(a){return this.getProfileDataUrl(a,"photo")};b.prototype.getProfileDataUrl=function(a,b){return a?
this.baseUrl+"/profiledata?id\x3d"+encodeURIComponent(a)+(b?"\x26type\x3d"+encodeURIComponent(b):""):null};f.createProfilesService=function(a){return new b(a)}});
